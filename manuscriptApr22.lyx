#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass extarticle
\begin_preamble
%\newcommand{\nicefrac}[2]{\ensuremath ^{#1}\!\!/\!_{#2}}
\usepackage{fancybox}
\usepackage[export]{adjustbox}

\usepackage{todonotes}
%\usepackage{afterpage}

%\usepackage[switch]{lineno}

\usepackage[colorlinks,bookmarksopen,bookmarksnumbered,citecolor=red,urlcolor=red]{hyperref}

\newcommand\BibTeX{{\rmfamily B\kern-.05em \textsc{i\kern-.025em b}\kern-.08em
T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

%\usepackage{moreverb}

\usepackage{flushend}
\end_preamble
\options times
\use_default_options false
\maintain_unincluded_children false
\language british
\language_package none
\inputencoding auto
\fontencoding global
\font_roman "times" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format pdf2
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type authoryear
\biblio_style \use_bibtopic false
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification false
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\paperwidth 15cm
\paperheight 12cm
\leftmargin 2.5cm
\topmargin 2.5cm
\rightmargin 2.5cm
\bottommargin 2.5cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Adaptively Implicit MPDATA Advection for Arbitrary Courant numbers and Meshes
\end_layout

\begin_layout Author
Hilary Weller, James Woodfield, Christian K
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
"u
\end_layout

\end_inset

hnlein and Piotr K.
 Smolarkiewicz
\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Subsection*
Motivation
\end_layout

\begin_layout Standard
Time step restrictions based on advection have always posed a problem for
 models of the atmosphere.
 The Courant-Friedrichs-Lewy (CFL) condition states that explicit Eulerian
 schemes will have time step restrictions based on the size of the domain
 of dependence.
 Typically this means that explicit schemes cannot run with a Courant number
 greater than one or thereabouts.
 This is equivalent to saying that an advected quantity cannot be moved
 by more than one mesh cell (or grid box) in one time step.
\end_layout

\begin_layout Standard
CFL constraints can be particularly cruel where spatial resolution is higher
 than it needs to be for accuracy, such as near the poles of a latitude-longitud
e mesh.
 An early work around was to use polar filtering; artificially removing
 oscillations near the poles where mesh lines converge 
\begin_inset CommandInset citation
LatexCommand citep
key "CD91"

\end_inset

.
 Polar filtering has been improved and used more recently in magneto-hydro-dynam
ics by 
\begin_inset CommandInset citation
LatexCommand citet
key "ZSL+19"

\end_inset

.
 However polar filtering led to parallel scaling bottlenecks and mistrust
 of solutions near the poles in models of the atmosphere.
 The UK Met Office gained accuracy and efficiency by replacing their model
 employing polar filtering with a semi-implicit , semi-Lagrangian (SISL)
 model to avoid time step restrictions on a latitude-longitude mesh 
\begin_inset CommandInset citation
LatexCommand citep
key "DCM+05"

\end_inset

.
 SISL eases time step constraints by treating acoustic and gravity waves
 implicitly while the advection is solved with the semi-Lagrangian method
 which is stable, accurate and efficient for long time steps but not conservativ
e.
 The lack of conservation is regarded as inadequate for climate modelling
 and is associated with spurious features such as eternal fountains which
 involve a positive feedback loop that creates moisture in convectively
 unstable columns 
\begin_inset CommandInset citation
LatexCommand citet
key "ZA20"

\end_inset

.
\end_layout

\begin_layout Standard
The requirement to run stably with large Courant numbers is less severe
 now that weather and climate models have largely moved away from latitude-longi
tude meshes in favour of quasi-uniform meshes such as the cubed sphere and
 icosahedral meshes 
\begin_inset CommandInset citation
LatexCommand citep
key "UJK+17"

\end_inset

.
 However, the problem remains severe in the vertical direction where mesh
 spacing can be fine and large vertical velocities can occur when atmospheric
 convection is resolved.
 A solution in the vertical direction is to use Lagrangian floating levels
 
\begin_inset CommandInset citation
LatexCommand citep
key "Lin04"

\end_inset

 that are conservatively mapped back to the fixed Eulerian mesh.
 Lagrangian floating levels are equivalent to conservative semi-Lagrangian
 
\begin_inset CommandInset citation
LatexCommand citep
key "HLM11"

\end_inset

 which can be made efficient for large Courant numbers in one dimension
 and consequently can work on tensor product meshes 
\begin_inset CommandInset citation
LatexCommand citep
before "eg."
key "LLM96"

\end_inset

.
 These are related to the Arbitrary Lagrangian-Eulerian (ALE) method 
\begin_inset CommandInset citation
LatexCommand citep
before "eg. "
key "HAC97"

\end_inset

 which solves equations in a Lagrangian frame and them remaps the solution
 back to the original mesh.
 However ALE methods suffer from time step restrictions associated with
 avoiding mesh distortions.
\end_layout

\begin_layout Standard
Due to the difficulties in allowing long time steps while maintaining exact
 local conservation on arbitrary meshes, it is worth considering implicit
 time stepping for advection.
 The aim of this paper is to present an advection scheme with the following
 properties:
\end_layout

\begin_layout Enumerate
Stable for very large Courant numbers.
\end_layout

\begin_layout Enumerate
Applicable on arbitrary meshes.
\end_layout

\begin_layout Enumerate
Similar cost and accuracy to explicit schemes when the Courant number is
 below one.
 
\end_layout

\begin_layout Enumerate
Monotonic when required.
\end_layout

\begin_layout Enumerate
At least first-order accurate where the Courant number is large.
\end_layout

\begin_layout Enumerate
Multi-tracer efficient.
\end_layout

\begin_layout Enumerate
Good parallel scaling.
\end_layout

\begin_layout Enumerate
Locally conservative to machine precision.
\end_layout

\begin_layout Standard
This paper proposes the use of blended implicit/explicit time stepping combined
 with the MPDATA advection scheme (multidimensional positive definite advection
 transport algorithm).
 However the methods for combining implicit and explicit and the method
 for achieving monotonicity should translate to other explicit advection
 schemes.
\end_layout

\begin_layout Subsection*
Background on MPDATA
\end_layout

\begin_layout Standard
MPDATA was introduced by 
\begin_inset CommandInset citation
LatexCommand citet
key "Smol83,Smol84"

\end_inset

 and reviewed by 
\begin_inset CommandInset citation
LatexCommand citet
key "SM98"

\end_inset

.
 MPDATA consists of a first-order upwind, explicit step to solve the advection
 equation followed by a correction step to remove the first-order error.
 An anti-diffusive velocity is calculated and the solution of the first-order
 step is corrected by advecting it with the anti-diffusive velocity.
 The corrective transport is also applied using explicit first-order upwind
 differencing so the solution remains positive definite.
 The anti-diffusive velocity is necessarily divergent so the scheme is not
 bounded above.
 The resulting scheme is second-order accurate in space and time and stable
 for a Courant number less than one.
 
\begin_inset CommandInset citation
LatexCommand citet
key "SS05b"

\end_inset

 extended MPDATA to unstructured meshes while retaining second-order accuracy.
\end_layout

\begin_layout Standard
In order to use MPDATA to advect vectors and other signed quantities and
 also to improve accuracy, MPDATA gauge effectively advects a quantity plus
 a constant in order to move values away from zero 
\begin_inset CommandInset citation
LatexCommand citep
key "SC86"

\end_inset

, meaning that the advected quantity is no longer bounded below by zero.
 Monotonicity can be enforced using flux-corrected transport 
\begin_inset CommandInset citation
LatexCommand citep
key "SG90,Zal79"

\end_inset

.
 
\begin_inset CommandInset citation
LatexCommand citet
key "KS17"

\end_inset

 combine the temporal correction with the divergence correction to create
 an anti-diffusive velocity that is defined only in terms of fluxes.
\end_layout

\begin_layout Subsection*
Background on Implicit Time Stepping
\end_layout

\begin_layout Standard
Implicit time stepping is ubiquitous in atmospheric modelling for solving
 the terms of the equations of motion responsible for fast waves such as
 gravity and acoustic waves.
 However, implicit time stepping has been used very little for advection
 in atmosphere and ocean modelling.
 Implicit time stepping for advection in the mathematics and engineering
 literature will be discussed first and then we will return to its uses
 to date in atmosphere and ocean modelling.
\end_layout

\begin_layout Standard
Implicit time stepping for advection has a severe order barrier; no implicit
 method exists with order greater than one which is monotonic for all time
 steps 
\begin_inset CommandInset citation
LatexCommand citep
key "GST01"

\end_inset

.
 Higher order implicit multi-stage (Runge-Kutta) and multi-step schemes
 exist that are unconditionally linearly stable but if we additionally require
 monotonicity (no new extrema generated), then higher-order implicit methods
 have time step restrictions, known as radii of monotonicity.
 As with spatial discretisation, high order implicit time stepping has been
 non-linearly combined with first order implicit time stepping to try to
 break the order barrier and increase the radius of monotoncity.
 
\begin_inset CommandInset citation
LatexCommand citet
key "YWH85,Yee87"

\end_inset

 proposed implicit TVD (total variation diminishing) schemes for solving
 hyperbolic equations and achieved high accuracy for large Courant numbers.
 However they could not find a second-order scheme that was guaranteed both
 TVD and conservative for non-constant coefficient advection.
 
\begin_inset CommandInset citation
LatexCommand citet
key "MB17"

\end_inset

 used flux corrected transport 
\begin_inset CommandInset citation
LatexCommand citep
before "FCT,"
key "Zal79"

\end_inset

 to improve temporal accuracy in implicitly solved small cells without generatin
g new extrema.
 
\end_layout

\begin_layout Standard
In atmospheric modelling, implicit time stepping for advection has been
 used for vertical advection 
\begin_inset CommandInset citation
LatexCommand citep
key "BSF+11"

\end_inset

, to treat small, cut-cells stably at modest time steps 
\begin_inset CommandInset citation
LatexCommand citep
before "e.g."
key "JKW11"

\end_inset

 and more recently to treat isolated strong updrafts stably 
\begin_inset CommandInset citation
LatexCommand citep
key "WS20"

\end_inset

.
 
\begin_inset CommandInset citation
LatexCommand citet
key "WS20"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand citet
key "Shch15"

\end_inset

 avoided the order barriers by limiting order of accuracy to first where
 ever implicit time stepping for advection was used.
 The lack of accuracy was not considered problematic because of the sparsity
 of the use of implicit advection.
 
\begin_inset CommandInset citation
LatexCommand citet
key "CWPS17"

\end_inset

 compared implicit advection with dimensionally split, flux-form semi-Lagrangian
 advection and found that the dimensionally split scheme was more accurate
 and more efficient than implicit advection for all Courant numbers.
 However, this was not a like for like comparison; the dimensionally split
 scheme was a higher-order accurate scheme, limited to tensor product meshes
 and suffered from mesh imprinting errors on distorted meshes.
 
\end_layout

\begin_layout Section
An Implicit/Explicit MPDATA
\end_layout

\begin_layout Standard
The version of explicit MPDATA and the blended implicit/explicit MPDATA
 defined here are implemented using the OpenFOAM library (
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://openfoam.org/
\end_layout

\end_inset

) using standard OpenFOAM operators and linear equation solvers.
 The code is available as part of the AtmosFOAM repository (
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://github.com/AtmosFOAM/
\end_layout

\end_inset

) compiled with OpenFOAM7.
 
\end_layout

\begin_layout Subsection
Explicit MPDATA on an Arbitrary Mesh
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset External
	template XFig
	filename figures/cells.fig
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Two cells in an arbitrary mesh.
 
\begin_inset Formula $\mathbf{x}_{C}$
\end_inset

 and 
\begin_inset Formula $\mathbf{x}_{N}$
\end_inset

 are the cell centres of cell 
\begin_inset Formula $C$
\end_inset

 and its neighbour, 
\begin_inset Formula $N$
\end_inset

, over face 
\begin_inset Formula $f$
\end_inset

 and 
\begin_inset Formula $\mathbf{x}_{f}$
\end_inset

 is the face centre.
 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 is the face area vector, normal to face 
\begin_inset Formula $f$
\end_inset

 with magnitude equal to the face area.
 
\begin_inset Formula $\mathbf{u}$
\end_inset

 is the velocity and 
\begin_inset Formula $\mathbf{x}_{d}$
\end_inset

 is the departure point for face 
\begin_inset Formula $f$
\end_inset

 at time 
\begin_inset Formula $n+\nicefrac{1}{2}$
\end_inset

 (i.e.
 the centre of the volume swept through the face between times 
\begin_inset Formula $n$
\end_inset

 and 
\begin_inset Formula $n+1$
\end_inset

).
\begin_inset CommandInset label
LatexCommand label
name "fig:cells"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The description of the explicit scheme is consistent with basic MPDATA principle
s 
\begin_inset CommandInset citation
LatexCommand citep
before "e.g."
key "SS05b"

\end_inset

, but introduces a novel derivation based on a flux-form semi-Lagrangian
 method and assuming an arbitrary mesh in Cartesian co-ordinates rather
 than using co-ordinate transforms.
 We will describe MPDATA for solving the linear advection equation for advected
 quantity 
\begin_inset Formula $\psi$
\end_inset

 with velocity field 
\begin_inset Formula $\mathbf{u}$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\frac{\partial\psi}{\partial t}+\nabla\cdot\left(\mathbf{u}\psi\right)=0.\label{eq:linearAdvection}
\end{equation}

\end_inset

This is solved using Gauss's divergence theorem on an arbitrary mesh to
 go from time level 
\begin_inset Formula $n$
\end_inset

 to 
\begin_inset Formula $n+1$
\end_inset

 a time step 
\begin_inset Formula $\Delta t$
\end_inset

 apart:
\begin_inset Formula 
\begin{equation}
\psi_{C}^{n+1}=\psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{f\in C}\psi_{f}^{n+\nicefrac{1}{2}}U_{f}\label{eq:advectionGauss}
\end{equation}

\end_inset

where 
\begin_inset Formula $\psi_{C}$
\end_inset

 is the cell mean value of 
\begin_inset Formula $\psi$
\end_inset

 in cell 
\begin_inset Formula $C$
\end_inset

, 
\begin_inset Formula $V_{C}$
\end_inset

 is the volume of cell 
\begin_inset Formula $C$
\end_inset

, 
\begin_inset Formula $f\in C$
\end_inset

 are the faces of cell 
\begin_inset Formula $C$
\end_inset

, 
\begin_inset Formula $\psi_{f}^{n+\nicefrac{1}{2}}$
\end_inset

 is the value of 
\begin_inset Formula $\psi$
\end_inset

 at face 
\begin_inset Formula $f$
\end_inset

 at time 
\begin_inset Formula $n+\nicefrac{1}{2}$
\end_inset

, 
\begin_inset Formula $\mathbf{u}_{f}$
\end_inset

 the velocity at face 
\begin_inset Formula $f$
\end_inset

 and 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 is the face area vector — the outward pointing vector normal to face 
\begin_inset Formula $f$
\end_inset

 with magnitude equal to the area of face 
\begin_inset Formula $f$
\end_inset

 (fig 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:cells"

\end_inset

).
 
\begin_inset Formula $U_{f}=\mathbf{u}_{f}\cdot\mathbf{S}_{f}$
\end_inset

 is the volume flux over face 
\begin_inset Formula $f$
\end_inset

.
 In this derivation of MPDATA, 
\begin_inset Formula $\psi_{f}$
\end_inset

 is evaluated at the departure point of the face centre at time 
\begin_inset Formula $n$
\end_inset

.
 The departure point, 
\begin_inset Formula $\mathbf{x}_{d}$
\end_inset

, is the centre of the volume swept through the face between times 
\begin_inset Formula $n$
\end_inset

 and 
\begin_inset Formula $n+1$
\end_inset

 which is approximated by the point a distance 
\begin_inset Formula $\mathbf{u}\Delta t/2$
\end_inset

 upstream of the face centre:
\begin_inset Formula 
\begin{equation}
\mathbf{x}_{d}=\mathbf{x}_{f}-\frac{\Delta t}{2}\mathbf{u}_{f}+O\left(\Delta t\right)^{2}\label{eq:departure}
\end{equation}

\end_inset

where 
\begin_inset Formula $\mathbf{x}_{f}$
\end_inset

 is the face centre (see fig 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:cells"

\end_inset

).
 The velocity, 
\begin_inset Formula $\mathbf{u}_{f}$
\end_inset

, is evaluated at time 
\begin_inset Formula $n+\nicefrac{1}{2}$
\end_inset

 at the face.
 In this paper the wind is prescribed.
 In a more complete model, 
\begin_inset Formula $\mathbf{u}_{f}^{n+\nicefrac{1}{2}}$
\end_inset

 would be evaluated from velocities at known positions and times.
 The dependent variable, 
\begin_inset Formula $\psi$
\end_inset

, is evaluated at the departure point using the upwind cell centre value
 of 
\begin_inset Formula $\psi$
\end_inset

, the gradient of 
\begin_inset Formula $\psi$
\end_inset

 and the velocity divergence:
\begin_inset Formula 
\begin{equation}
\psi_{f}^{n+\nicefrac{1}{2}}=\psi_{d}^{n}=\psi_{\text{up}}^{n}+\left(\mathbf{x}_{d}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi^{n}-\frac{\Delta t}{2}\psi_{\text{up}}^{n}\nabla\cdot\mathbf{u}+O\left(\Delta x^{2},\Delta t^{2}\right)\label{eq:PsiDep}
\end{equation}

\end_inset

where 
\begin_inset Formula $\psi_{\text{up}}$
\end_inset

 is the value of 
\begin_inset Formula $\psi$
\end_inset

 in the cell upwind of face 
\begin_inset Formula $f$
\end_inset

.
 
\begin_inset Formula $\nabla\psi$
\end_inset

 can be calculated in cells (
\begin_inset Formula $C$
\end_inset

) to second-order accuracy on an arbitrary mesh using a least-squares approximat
ion:
\begin_inset Formula 
\begin{equation}
\nabla\psi=\sum_{f\in C}\mathbf{g}_{f}\left(\psi_{N}-\psi_{C}\right)
\end{equation}

\end_inset

where 
\begin_inset Formula $\psi_{N}$
\end_inset

 is 
\begin_inset Formula $\psi$
\end_inset

 in the neighbour of cell 
\begin_inset Formula $C$
\end_inset

 across face 
\begin_inset Formula $f$
\end_inset

 and where 
\begin_inset Formula $\mathbf{g}_{f}$
\end_inset

 is a vector calculated for each face of cell 
\begin_inset Formula $C$
\end_inset

 based entirely on the local mesh geometry:
\begin_inset Formula 
\begin{eqnarray*}
\mathbf{g}_{f} & = & \left(1-w_{f}\right)\frac{|\mathbf{S}_{f}|}{|\mathbf{x}_{N}-\mathbf{x}_{C}|^{2}}D_{C}^{-1}\left(\mathbf{x}_{N}-\mathbf{x}_{C}\right)\\
\text{where }w_{f} & = & \frac{|\mathbf{S}_{f}\cdot(\mathbf{x}_{N}-\mathbf{x}_{f})|}{|\mathbf{S}_{f}\cdot(\mathbf{x}_{N}-\mathbf{x}_{f})|+|\mathbf{S}_{f}\cdot(\mathbf{x}_{f}-\mathbf{x}_{C})|}\ \text{(interpolation weights)}\\
\text{where }D_{C} & = & \sum_{f\in C}\left(1-w_{f}\right)\frac{|\mathbf{S}_{f}|}{|\mathbf{x}_{N}-\mathbf{x}_{C}|^{2}}\left(\mathbf{x}_{N}-\mathbf{x}_{C}\right)\left(\mathbf{x}_{N}-\mathbf{x}_{C}\right)^{T}
\end{eqnarray*}

\end_inset

This is the least squares gradient implemented in the OpenFOAM library.
 Equations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:departure"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:PsiDep"

\end_inset

) are substituted in to (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:advectionGauss"

\end_inset

) to give a scheme that is second-order accurate in space and time but not
 positive definite, equivalent to a Law-Wendroff scheme:
\begin_inset Formula 
\begin{eqnarray}
\psi_{C}^{n+1} & \approx & \psi_{C}^{n}-\underbrace{\frac{\Delta t}{V_{C}}\sum_{f\in C}\psi_{\text{up}}^{n}U_{f}}_{\text{explicit upwind}}-\underbrace{\frac{\Delta t}{V_{C}}\sum_{f\in C}\left(\mathbf{x}_{f}\!-\!\mathbf{x}_{\text{up}}\right)\cdot\left(\nabla\psi^{n}\right)U_{f}}_{\text{spatial corection}}+\underbrace{\frac{\Delta t^{2}}{2V_{C}}\sum_{f\in C}\left(\nabla\cdot\left(\mathbf{u}\psi^{n}\right)\right)U_{f}}_{\text{temporal correction}}\label{eq:advectionGauss-1}
\end{eqnarray}

\end_inset

The explicit upwind term does not introduce unbounded solutions.
 In order for the second-order and divergence correction terms to be sign-preser
ving, they are written as explicit upwind advection using an anti-diffusive
 flux, 
\begin_inset Formula $V_{f}=\mathbf{v}_{f}\cdot\mathbf{S}_{f}$
\end_inset

, which transforms the scheme from Lax-Wendroff to MPDATA and is written
 in two stages:
\begin_inset Formula 
\begin{eqnarray}
\text{explicit diffusive step: }\psi_{C}^{d} & = & \psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{f\in C}\psi_{\text{up}}^{n}U_{f}\\
\text{explicit correction: }\psi_{C}^{n+1} & = & \psi_{C}^{d}-\frac{\Delta t}{V_{C}}\sum_{f\in C}\psi_{\text{vup}}^{d}V_{f}\\
\text{where }V_{f}=\mathbf{v}_{f}\cdot\mathbf{S}_{f} & = & \frac{U_{f}}{\psi_{\text{denom}}}\left\{ \left(\mathbf{x}_{f}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi-\frac{\Delta t}{2}\nabla\cdot\left(\psi\mathbf{u}\right)\right\} \label{eq:antiDfluxExp}
\end{eqnarray}

\end_inset

and where 
\begin_inset Formula $\psi_{\text{vup}}$
\end_inset

 is 
\begin_inset Formula $\psi$
\end_inset

 in the upwind cell where the upwind direction is defined by the sign of
 
\begin_inset Formula $V_{f}$
\end_inset

.
 As 
\begin_inset Formula $\psi$
\end_inset

 is always positive, there is no ambiguity in the sign of 
\begin_inset Formula $V_{f}$
\end_inset

.
 The anti-diffusive flux, 
\begin_inset Formula $V_{f}$
\end_inset

, can be calculated iteratively, using first 
\begin_inset Formula $\psi^{d}$
\end_inset

 and subsequent iterations use the most up to date version of 
\begin_inset Formula $\psi^{n+1}$
\end_inset

.
 Eqn (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:antiDfluxExp"

\end_inset

) is a continuous version of the expression for the anti-diffusive velocity
 in eqn (13) of 
\begin_inset CommandInset citation
LatexCommand citet
key "SS05b"

\end_inset

.
 The discretisaions of gradients, divergences and 
\begin_inset Formula $\psi_{\text{denom}}$
\end_inset

 described here give exactly the same expression as 
\begin_inset CommandInset citation
LatexCommand citet
key "SS05b"

\end_inset

 on a uniform structured grid but the treatment of non-uniformity and skewness
 are slightly different here.
\end_layout

\begin_layout Standard
The explicit diffusive step has a Courant number limit of half for a divergent
 velocity field and one for a non-divergent velocity field.
 This can be seen by writing the advection as the sum of outward and inward
 fluxes:
\begin_inset Formula 
\begin{eqnarray}
\psi_{C}^{d} & = & \psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{U_{f}>0}\psi_{C}^{n}U_{f}+\frac{\Delta t}{V_{C}}\sum_{U_{f}<0}\psi_{N}^{n}|U_{f}|\\
 & = & \psi_{C}^{n}\left\{ 1-\frac{\Delta t}{V_{C}}\sum_{U_{f}>0}U_{f}\right\} +\frac{\Delta t}{V_{C}}\sum_{U_{f}<0}\psi_{N}^{n}|U_{f}|.
\end{eqnarray}

\end_inset

For a divergent velocity field, 
\begin_inset Formula $\psi_{C}^{d}$
\end_inset

 is positive when the term in curly brackets is non-negative which happens
 when 
\begin_inset Formula $\frac{\Delta t}{V_{C}}\sum_{U_{f}>0}U_{f}\le1$
\end_inset

.
 The Courant number on an arbitrary mesh is defined as
\begin_inset Formula 
\begin{equation}
c=\frac{1}{2}\frac{\Delta t}{V_{C}}\sum_{f}|U_{f}|\label{eq:Courant}
\end{equation}

\end_inset

so a Courant number limit of half guarantees sign-preservation.
 For a non-divergent velocity field:
\begin_inset Formula 
\begin{equation}
\sum_{U_{f}>0}U_{f}=\sum_{U_{f}<0}|U_{f}|=c
\end{equation}

\end_inset

so the solution is bounded when the Courant number is less than one.
\end_layout

\begin_layout Standard
For the explicit correction to be positive definite and stable, the anti-diffusi
ve velocity needs to obey the same Courant number restriction.
 Considering the case with uniform velocity in one dimension and uniform
 
\begin_inset Formula $\nabla\psi$
\end_inset

 and remembering that 
\begin_inset Formula $\psi\ge0$
\end_inset

 and 
\begin_inset Formula $c\in[0,1]$
\end_inset

, this is equivalent to
\begin_inset Formula 
\begin{eqnarray*}
c\left(1-c\right)\frac{|\psi_{C}-\psi_{N}|}{2\psi_{\text{denom}}} & \le & 1.
\end{eqnarray*}

\end_inset

Following 
\begin_inset CommandInset citation
LatexCommand citet
key "SS05b"

\end_inset


\begin_inset Formula 
\begin{equation}
\psi_{\text{denom}}=\frac{1}{2}\left(\psi_{C}+\psi_{N}+\varepsilon\right)
\end{equation}

\end_inset

where 
\begin_inset Formula $\varepsilon$
\end_inset

 is a small number.
 This ensures that explicit MPDATA is positive definite.
 The results presented here use 
\begin_inset Formula $\varepsilon=10^{-16}$
\end_inset

.
\end_layout

\begin_layout Subsection
Blended Implicit/Explicit MPDATA
\begin_inset CommandInset label
LatexCommand label
name "subsec:MPDATA_theta"

\end_inset


\end_layout

\begin_layout Standard
The blended implicit/explicit scheme is a generalisation of Crank-Nicolson
 with off-centering 
\begin_inset Formula $\theta$
\end_inset

 which can vary in space.
 
\begin_inset Formula $\theta$
\end_inset

 is defined on faces (for conservation) so the time stepping is defined
 as:
\begin_inset Formula 
\begin{equation}
\psi_{C}^{n+1}=\psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{f\in C}\left\{ \left(1-\theta_{f}\right)\psi_{f}^{n}+\theta_{f}\psi_{f}^{n+1}\right\} U_{f}.\label{eq:advectionGauss-2}
\end{equation}

\end_inset

This is second order in time only for 
\begin_inset Formula $\theta=\frac{1}{2}$
\end_inset

.
 We will find the MPDATA anti-diffusive flux that corrects a scheme which
 is first-order accurate in space and off-centered by 
\begin_inset Formula $\theta$
\end_inset

 in time.
 So the first step, before the MPDATA correction, is:
\begin_inset Formula 
\begin{equation}
\psi_{C}^{d}=\psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{f\in C}\left\{ \left(1-\theta_{f}\right)\psi_{\text{up}}^{n}+\theta_{f}\psi_{\text{up}}^{d}\right\} U_{f}.\label{eq:thetaUp}
\end{equation}

\end_inset

The proof that this first step gives positive solutions and bounded solutions
 for non-divergent velocity fields on arbitrary meshes is in appendix 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:appxBounded"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset External
	template XFig
	filename figures/departureArrival.fig
	display false
	scale 50

\end_inset

 
\begin_inset External
	template XFig
	filename figures/departureArrivalLargec.fig
	display false
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The volume that is swept through face 
\begin_inset Formula $f$
\end_inset

 in one time step and the departure and arrival points, 
\begin_inset Formula $\mathbf{x}_{d}$
\end_inset

 and 
\begin_inset Formula $\mathbf{x}_{a}$
\end_inset

 for small (left) and large (right) Courant numbers.
\begin_inset CommandInset label
LatexCommand label
name "fig:departureArrival"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To find the second-order approximation of 
\begin_inset Formula $\psi_{f}^{n+1/2}$
\end_inset

, we consider a linear combination of 
\begin_inset Formula $\psi$
\end_inset

 at the departure point at time 
\begin_inset Formula $n$
\end_inset

 and 
\begin_inset Formula $\psi$
\end_inset

 at the arrival point at time 
\begin_inset Formula $n+1$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\psi_{f}^{n+1/2}=\left(1-\theta_{f}\right)\psi_{d}^{n}+\theta_{f}\psi_{a}^{n+1}\label{eq:thetaPsiFace}
\end{equation}

\end_inset

where the locations of the departure and arrival points are shown in fig
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:departureArrival"

\end_inset

 and are given by
\begin_inset Formula 
\begin{eqnarray*}
\mathbf{x}_{d} & = & \mathbf{x}_{f}-\frac{\Delta t}{2}\mathbf{u}_{f}\\
\mathbf{x}_{a} & = & \mathbf{x}_{f}+\frac{\Delta t}{2}\mathbf{u}_{f}
\end{eqnarray*}

\end_inset

The values of 
\begin_inset Formula $\psi$
\end_inset

 and the departure and arrival points can be approximated by
\begin_inset Formula 
\begin{eqnarray*}
\psi_{d}^{n} & = & \psi_{\text{up}}^{n}+\left(\mathbf{x}_{d}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi\\
\psi_{a}^{n+1} & = & \psi_{\text{up}}^{n+1}+\left(\mathbf{x}_{a}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi.
\end{eqnarray*}

\end_inset

Substituting these into (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:thetaPsiFace"

\end_inset

) gives
\begin_inset Formula 
\begin{eqnarray}
\psi_{f}^{n+\nicefrac{1}{2}} & = & \left(1-\theta_{f}\right)\psi_{\text{up}}^{n}+\theta_{f}\psi_{\text{up}}^{n+1}+\left(\mathbf{x}_{d}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi^{n}-\left(1-2\theta_{f}\right)\frac{\Delta t}{2}\mathbf{u}\cdot\nabla\psi\label{eq:PsiDep-1}
\end{eqnarray}

\end_inset

where 
\begin_inset Formula $\mathbf{x}_{\text{up}}$
\end_inset

 is the centre of the cell upwind of face 
\begin_inset Formula $f$
\end_inset

.
 This correction is not stable for Courant number, 
\begin_inset Formula $c>2$
\end_inset

 or 
\begin_inset Formula $\theta>\frac{1}{2}$
\end_inset

 (appendix 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:appxStability"

\end_inset

).
 For stability for all 
\begin_inset Formula $c$
\end_inset

 and second-order accuracy where 
\begin_inset Formula $\theta\le\frac{1}{2}$
\end_inset

 the correction step is:
\begin_inset Formula 
\begin{eqnarray}
\psi_{C}^{n+1} & = & \psi_{C}^{d}+\frac{\Delta t}{V_{C}}\sum_{f\in C}\psi_{\text{vup}}^{d}V_{f}\\
\text{where }V_{f} & = & \mathbf{v}_{f}\cdot\mathbf{S}_{f}=\frac{U_{f}}{\psi_{\text{denom}}}\left\{ \left(\mathbf{x}_{f}-\mathbf{x}_{\text{up}}\right)\cdot\nabla\psi-\chi\frac{\Delta t}{2}\mathbf{u}\cdot\nabla\psi\right\} \label{eq:Vcorr}\\
\chi & = & \max\left(1-2\theta_{f},\ 0\right)
\end{eqnarray}

\end_inset

This gives a first-order error in time for 
\begin_inset Formula $\theta>\frac{1}{2}$
\end_inset

 which is only used for large Courant numbers (
\begin_inset Formula $>2$
\end_inset

).
 It is stable on a uniform one-dimensional grid (appendix 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:appxStability"

\end_inset

) but on an arbitrary mesh, some smoothing is needed when 
\begin_inset Formula $\theta>0$
\end_inset

 (section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:smoothing"

\end_inset

).
\end_layout

\begin_layout Standard
Appendix 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:appxStability"

\end_inset

 shows that the first (diffusive) step of the implicit/explicit MPDATA 
\begin_inset Formula $\theta$
\end_inset

 scheme, eqn (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:thetaUp"

\end_inset

), is stable and bounded when 
\begin_inset Formula 
\begin{eqnarray}
\theta\ge1-\frac{1}{c} & \text{and} & \theta\ge0\label{eq:thetaBounds}
\end{eqnarray}

\end_inset

with the Courant number for an arbitrary mesh, 
\begin_inset Formula $c$
\end_inset

, defined as in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Courant"

\end_inset

).
 Eqn (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:thetaBounds"

\end_inset

) can be used to set 
\begin_inset Formula $\theta_{f}$
\end_inset

 based on the values of the Courant number in the cells either side, 
\begin_inset Formula $c_{\text{up}}$
\end_inset

 and 
\begin_inset Formula $c_{\text{down}}$
\end_inset

 with a degree of safety added to avoid reaching the stability limits:
\begin_inset Formula 
\begin{equation}
\theta_{f}=\max\left\{ 1-\frac{1}{c_{\text{up}}+0.25},\ 1-\frac{1}{c_{\text{down}}+0.25},\ 0\right\} .
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Additional Smoothing for Large Courant numbers 
\begin_inset CommandInset label
LatexCommand label
name "subsec:smoothing"

\end_inset


\end_layout

\begin_layout Standard
Appendix 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:appxStability"

\end_inset

 shows that a linearised version of the implicit/explicit MPDATA is unconditiona
lly stable on a uniform, one-dimensional grid.
 However this does not carry over onto an arbitrary mesh.
 Therefore 
\begin_inset Formula $V_{f}$
\end_inset

 is smoothed where 
\begin_inset Formula $\theta>0$
\end_inset

.
 First a cell centre anti-diffusive flux is reconstructed from surrounding
 fluxes:
\begin_inset Formula 
\begin{equation}
\mathbf{v}_{C}=\left(\sum_{f\in C}\mathbf{S}_{f}\mathbf{S}_{f}^{T}\right)^{-1}\sum_{f\in C}\mathbf{S}_{f}V_{f}
\end{equation}

\end_inset

which is the standard reconstruction of vectors from fluxes implemented
 in OpenFOAM (
\begin_inset Formula $\sum_{f\in C}\mathbf{S}_{f}\mathbf{S}_{f}^{T}$
\end_inset

 is a tensor which can be inverted and pre-calculated for each cell).
 This is a second-order accurate, least squares reconstruction which reconstruct
s a uniform vector field exactly.
 The reconstructed velocity is then interpolated back onto faces and the
 dot product taken with 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 to get a smoothed flux.
 The smoothed flux is used where 
\begin_inset Formula $\theta>0$
\end_inset

 and at the faces of cells with one face with 
\begin_inset Formula $\theta>0$
\end_inset

:
\begin_inset Formula 
\begin{equation}
V_{f}=\begin{cases}
V_{f}\text{ from }(\ref{eq:Vcorr}) & \theta=0\\
\mathbf{v}_{Cf}\cdot\mathbf{S}_{f} & \theta>0
\end{cases}\label{eq:VcorrSmooth}
\end{equation}

\end_inset

where 
\begin_inset Formula $\mathbf{v}_{Cf}$
\end_inset

 is the reconstructed velocity 
\begin_inset Formula $\mathbf{v}_{C}$
\end_inset

 linearly interpolated from cell centres to faces.
\end_layout

\begin_layout Subsection
Linear Equation Solver
\end_layout

\begin_layout Standard
The first-order upwind blended implicit/explicit advection creates a sparse,
 asymmetric matrix 
\begin_inset Formula $M$
\end_inset

 with positive elements on the diagonal.
 To create the matrix equation, (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:thetaUp"

\end_inset

) is re-arranged so that the vector of new 
\begin_inset Formula $\psi^{d}$
\end_inset

 values (
\begin_inset Formula $\underline{\psi}^{d}$
\end_inset

) is a linear combination of old 
\begin_inset Formula $\psi^{n}$
\end_inset

 values (
\begin_inset Formula $\underline{\psi}^{n}$
\end_inset

):
\begin_inset Formula 
\begin{eqnarray}
M\underline{\psi}^{d} & = & N\underline{\psi}^{n}\\
\text{where }M_{ij} & = & \begin{cases}
1+\frac{\Delta t}{V_{i}}\sum_{f\in i}\theta_{f}\max\left\{ U_{f},0\right\}  & \text{for }i=j\\
-\frac{\Delta t}{V_{i}}\theta_{f}\max\left\{ -U_{f},0\right\}  & \text{where }f\text{ is between cells }i\text{ and }j
\end{cases}\\
\text{and }N_{ij} & = & \begin{cases}
1-\frac{\Delta t}{V_{i}}\sum_{f\in i}\left(1-\theta_{f}\right)\max\left\{ U_{f},0\right\}  & \text{for }i=j\\
+\frac{\Delta t}{V_{i}}\left(1-\theta_{f}\right)\max\left\{ -U_{f},0\right\}  & \text{where }f\text{ is between cells }i\text{ and }j
\end{cases}
\end{eqnarray}

\end_inset

Matrix 
\begin_inset Formula $N$
\end_inset

 is of course not created because the right hand vector entries can be evaluated
 directly.
 If the flow is divergence free then 
\begin_inset Formula $\sum_{f\in i}U_{f}=0$
\end_inset

 which implies that 
\begin_inset Formula $M$
\end_inset

 is strictly diagonally dominant.
 
\begin_inset Formula $M$
\end_inset

 will not be diagonally dominant at row 
\begin_inset Formula $i$
\end_inset

 if the volume flux into cell 
\begin_inset Formula $i$
\end_inset

 in one time step is greater than the volume flux out in that time step
 plus the cell volume.
 This situation is not likely for atmospheric modelling as the atmosphere
 is low Mach number but it would require either a smaller time step or a
 matrix solver suitable for non-diagonally dominant matrices.
 
\end_layout

\begin_layout Standard
The matrix equations generated are solved with the standard OpenFOAM bi-conjugat
e gradient solver with a diagonal-based Incomplete LU preconditioner.
 Details of tolerances and iteration counts is given in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:SolverPerformace"

\end_inset

.
\end_layout

\begin_layout Subsection
MPDATA Gauge
\end_layout

\begin_layout Standard
The infinite gauge variant of MPDATA (equivalent to Lax-Wendroff) can be
 used with implicit/explicit time stepping exactly as it is used with standard,
 explicit MPDATA 
\begin_inset CommandInset citation
LatexCommand citep
key "SC86,KS17"

\end_inset

.
 This removes the non-linearity of MPDATA and means that MPDATA is no longer
 sign preserving.
 
\end_layout

\begin_layout Subsection
Flux Corrected Transport (FCT) with Implicit Time Stepping
\begin_inset CommandInset label
LatexCommand label
name "subsec:FCT"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand citet
key "Zal79"

\end_inset

 state that their flux corrected transport (FCT) algorithm can be used with
 implicit time stepping although we have not found examples of this in the
 literature.
 In fact, the algorithm as described by 
\begin_inset CommandInset citation
LatexCommand citet
key "Zal79"

\end_inset

 does not guarantee monotonicity when used with implicit time stepping.
 This is because 
\begin_inset CommandInset citation
LatexCommand citet
key "Zal79"

\end_inset

 bound the tracer at time 
\begin_inset Formula $n+1$
\end_inset

 by the diffusively transported tracer at time 
\begin_inset Formula $n+1$
\end_inset

 and the tracer at time 
\begin_inset Formula $n$
\end_inset

 at the current and upwind grid points.
 The tracer at time 
\begin_inset Formula $n$
\end_inset

 at the current and upwind grid points are not a suitable bounds if the
 tracer can move a long distance in one time step.
 When using implicit time stepping and large Courant numbers, local extrema
 can be advected by more than one mesh cell in one time step so local bounds
 from the previous time step no longer apply.
 We therefore define two variants of FCT to work with implicit time stepping.
 One guarantees monotonicity and the other guarantees boundedness within
 pre-defined bounds.
 
\end_layout

\begin_layout Standard
The first step if FCT is to advect using a monotonic, diffusive scheme to
 calculate 
\begin_inset Formula $\psi^{d}$
\end_inset

.
 Appendix 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:appxBounded"

\end_inset

 shows that the first-order upwind in space, blended explicit/implicit scheme
 (eqn 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:thetaUp"

\end_inset

) provides this solution for arbitrary Courant numbers.
 The next step is to calculate the allowable minima and maxima for each
 cell which we will call 
\begin_inset Formula $\psi_{\min}$
\end_inset

 and 
\begin_inset Formula $\psi_{\max}$
\end_inset

.
 If we seek boundedness within pre-defined bounds then 
\begin_inset Formula $\psi_{\min}$
\end_inset

 and 
\begin_inset Formula $\psi_{\max}$
\end_inset

 are these bounds.
 Otherwise 
\begin_inset Formula $\psi_{\min}$
\end_inset

 and 
\begin_inset Formula $\psi_{\max}$
\end_inset

 are the local extrema of 
\begin_inset Formula $\psi^{d}$
\end_inset

 in the current and neighbouring cells.
 Explicit FCT also uses 
\begin_inset Formula $\psi^{n}$
\end_inset

 which widens the bounds.
 Consequently, FCT for implicit, monotonic advection will be more diffusive
 because of the use solely of 
\begin_inset Formula $\psi^{d}$
\end_inset

 to define the local bounds:
\begin_inset Formula 
\begin{eqnarray}
\text{for cell }C\ \psi_{\min} & = & \min_{N\in C}\left\{ \psi_{N}^{d}\right\} \ \text{where }N\ \text{are the face neighbours of }C\label{eq:boundsMin}\\
\text{for cell }C\ \psi_{\max} & = & \max_{N\in C}\left\{ \psi_{N}^{d}\right\} \ \text{where }N\ \text{are the face neighbours of }C.\label{eq:boundsMax}
\end{eqnarray}

\end_inset

We next define the maximum allowable amount that each cell can rise or fall
 by and use the same notation as 
\begin_inset CommandInset citation
LatexCommand citet
key "Zal79"

\end_inset


\begin_inset Formula 
\begin{eqnarray}
Q_{p} & = & \psi_{\max}-\psi^{d}\\
Q_{m} & = & \psi^{d}-\psi_{\min}.
\end{eqnarray}

\end_inset

We next need to modify the unbounded MPDATA high order flux corrections
 (HOC) from the implicit/explicit correction.
 This is the MPDATA flux correction, 
\begin_inset Formula $V_{f}$
\end_inset

, from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:VcorrSmooth"

\end_inset

) multiplied by 
\begin_inset Formula $\psi_{d}$
\end_inset

 at the upwind cell (upwind defined relative to 
\begin_inset Formula $V_{f}$
\end_inset

):
\begin_inset Formula 
\begin{equation}
F_{f\text{HOC}}=\psi_{d\text{up}}V_{f}.
\end{equation}

\end_inset

From this we calculate the total high order flux that enters (
\begin_inset Formula $P_{p}$
\end_inset

) and leaves (
\begin_inset Formula $P_{m}$
\end_inset

) each cell:
\begin_inset Formula 
\begin{eqnarray}
P_{p} & = & -\frac{\Delta t}{V_{C}}\sum_{f\in C}\min\left\{ F_{f\text{HOC}},\ 0\right\} \\
P_{m} & = & \frac{\Delta t}{V_{C}}\sum_{f\in C}\max\left\{ F_{f\text{HOC}},\ 0\right\} .
\end{eqnarray}

\end_inset

Next we find the ratios of the allowable total fluxes to the actual high
 order fluxes:
\begin_inset Formula 
\begin{eqnarray}
R_{p} & = & \begin{cases}
\min\left\{ 1,\ \frac{Q_{p}}{P_{p}}\right\}  & \text{if }P_{p}>0\\
0 & \text{otherwise}
\end{cases}\\
R_{m} & = & \begin{cases}
\min\left\{ 1,\ \frac{Q_{m}}{P_{m}}\right\}  & \text{if }P_{m}>0\\
0 & \text{otherwise.}
\end{cases}
\end{eqnarray}

\end_inset

Finally we find the coefficient to multiply 
\begin_inset Formula $F_{f\text{HOC}}$
\end_inset

 in order to achieve either a monotonic solution or a solution with the
 required bounds:
\begin_inset Formula 
\begin{eqnarray*}
F_{f} & = & \begin{cases}
F_{f\text{HOC}}\min\left\{ R_{pN},\ R_{mC}\right\}  & \text{if }F_{f\text{HOC}}\ge0\\
F_{f\text{HOC}}\min\left\{ R_{pC},\ R_{mN}\right\}  & \text{otherwise}
\end{cases}\\
\text{where} &  & \left(\mathbf{x}_{N}-\mathbf{x}_{C}\right)\cdot\mathbf{S}_{f}>0
\end{eqnarray*}

\end_inset

and cells 
\begin_inset Formula $C$
\end_inset

 and 
\begin_inset Formula $N$
\end_inset

 are either side of face 
\begin_inset Formula $f$
\end_inset

.
 Then the final update is
\begin_inset Formula 
\begin{equation}
\psi_{C}^{n+1}=\psi_{C}^{d}-\frac{\Delta t}{V_{C}}\sum_{f\in C}F_{f}
\end{equation}

\end_inset

which is monotonic if (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:boundsMin"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:boundsMax"

\end_inset

) are used to bound 
\begin_inset Formula $\psi$
\end_inset

 and bounded if specific bounds are specified.
\end_layout

\begin_layout Section
Advection Test Cases
\end_layout

\begin_layout Subsection
One-dimensional Advection
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
Implicit/explicit MPDATA
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/1d/nonUniform/twoShapes/MPDATA/mesh10_100/1/Tcompare.eps
	lyxscale 50
	width 75text%

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Implicit/explicit infinite gauge MPDATA
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/1d/nonUniform/twoShapes/LW/mesh10_100/1/Tcompare.eps
	lyxscale 50
	width 75text%

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Implicit/explicit infinite gauge MPDATA with FCT
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/1d/nonUniform/twoShapes/LW_FCT/mesh10_100/1/Tcompare.eps
	lyxscale 50
	width 75text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Advection once around a periodic domain starting from mixed initial conditions
 
\begin_inset Formula $\psi^{0}$
\end_inset

 using 40 grid points for the uniform resolution and 100 grid points for
 the resolution with a factor 
\begin_inset Formula $R=10$
\end_inset

 between finest and coarsest.
 The regions where the non-uniform resolution has a Courant number greater
 than 0.75 (where implicit time stepping is used) is shaded grey.
\begin_inset CommandInset label
LatexCommand label
name "fig:1dresults"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The first test of the blended implicit/explicit MPDATA is in one dimensional
 with uniform velocity.
 In order to vary the Courant number in space so that the scheme is implicit
 and explicit in different places, variable resolution is used and compared
 with uniform resolution simulations.
 The variable resolution grids have resolution a factor of 
\begin_inset Formula $R=10$
\end_inset

 finer in the middle of the unit length domain than the end points.
 There are 
\begin_inset Formula $n$
\end_inset

 cells (
\begin_inset Formula $n+1$
\end_inset

 grid points) in the unit length and a constant ratio, 
\begin_inset Formula $r=R^{\frac{2}{n-2}}$
\end_inset

, between successive cells in the first half of the domain and 
\begin_inset Formula $\frac{1}{r}$
\end_inset

 in the second half.
 Therefore the resolution of cell 
\begin_inset Formula $i$
\end_inset

 is:
\begin_inset Formula 
\begin{equation}
\Delta x_{i}=\begin{cases}
\frac{1}{2}Rr^{-i}\frac{1-r}{1-rR} & i\le\frac{n}{2}-1\\
\frac{1}{2}Rr^{\frac{n}{2}-i}\frac{1-r}{1-rR} & i\ge\frac{n}{2}.
\end{cases}
\end{equation}

\end_inset

We use smooth initial conditions for evaluating convergence with resolution
 and mixed initial conditions for inspecting boundedness and overall quality
 of solution:
\begin_inset Formula 
\begin{eqnarray}
\psi_{\text{smooth}}^{0} & = & \begin{cases}
\frac{1}{2}\left\{ 1+\cos\pi\left(4x-1\right)\right\}  & x\in\left[0,0.5\right]\\
0 & \text{otherwise}
\end{cases}\\
\psi_{\text{mixed}}^{0} & = & \begin{cases}
\frac{1}{2}\left\{ 1+\cos\pi\left(4x-1\right)\right\}  & x\in\left[0,0.5\right]\\
1 & x\in\left[0.6,0.8\right]\\
0 & \text{otherwise.}
\end{cases}
\end{eqnarray}

\end_inset

All simulations use velocity of 
\begin_inset Formula $u=1$
\end_inset

 and run for one time unit so that the tracer travels one complete revolution
 around the periodic domain.
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:1dresults"

\end_inset

 shows solutions starting from the mixed initial conditions using 100 time
 steps each of length 
\begin_inset Formula $\Delta t=0.01$
\end_inset

.
 The uniform resolution has 40 cells giving a uniform Courant number of
 0.4 (meaning that the time stepping is purely explicit).
 The non-uniform resolution has 100 cells with 
\begin_inset Formula $R=10$
\end_inset

 giving a Courant numbers in the range 
\begin_inset Formula $c\in\left[0.4,4\right]$
\end_inset

 so that implicit time stepping is used where 
\begin_inset Formula $c>0.75$
\end_inset

.
 As expected, the MPDATA results (top row of figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:1dresults"

\end_inset

) are always positive for both the uniform resolution (explicit time stepping)
 and the non-uniform resolution (implicit/explicit time stepping).
 The non-uniform resolution solution produces a stable overshoot above the
 square wave which cannot be ruled out by MPDATA without limited fluxes.
 The infinite gauge version of MPDATA (middle row of figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:1dresults"

\end_inset

) produces undershoots and overshoots and the solution is more accurate
 in the region of the smooth wave.
 Neither the uniform (explicit) or non-uniform (implicit/explicit) results
 appear more accurate than the other.
 The results using flux-corrected transport (FCT, bottom row of figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:1dresults"

\end_inset

) are bounded above and below, demonstrating the efficacy of the flux correction
s applied to implicit/explicit time stepping.
 The uniform (explicit) or non-uniform (implicit/explicit) results appear
 very similar.
\end_layout

\begin_layout Standard
\noindent
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/1d/nonUniform/cosBell/plots/l2converge.eps
	width 75text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Convergence of the 
\begin_inset Formula $\ell_{2}$
\end_inset

 error norm with resolution of the one-dimensional advection of the smooth
 initial conditions, 
\begin_inset Formula $\psi^{0}$
\end_inset

.
 The uniform resolutions use 20, 40 and 80 grid points and the non-uniform
 resolutions use 50, 100 and 200 grid points with ratio 
\begin_inset Formula $R=10$
\end_inset

.
 Both use time steps of 
\begin_inset Formula $\Delta t=0.02$
\end_inset

, 0.01 and 0.005.
 Dotted lines show the slope of first and second-order convergence.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:1d_converge"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Convergence with resolution for all schemes on uniform and non-uniform meshes
 starting from the smooth initial conditions is shown in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:1d_converge"

\end_inset

.
 The uniform meshes always use purely explicit time stepping (
\begin_inset Formula $c=0.4$
\end_inset

) and the non-uniform meshes use blended implicit/explicit since 
\begin_inset Formula $c\in\left[0.4,4\right]$
\end_inset

.
 MPDATA with and without the infinite gauge and with and without FCT give
 second-order convergence.
 Even though the non-uniform grid means that the Courant number reaches
 4 at the centre of the domain, the convergence remains strong.
\end_layout

\begin_layout Subsection
Spherical Meshes
\end_layout

\begin_layout Standard
Advection test cases using implicit/explicit MPDATA calculated using various
 meshes are presented.
 There is no clearly optimal mesh of the sphere for atmospheric modelling
 (example meshes in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset

).
 Numerical methods need to be designed to allow for one or more of the following
 features of meshes of the sphere:
\end_layout

\begin_layout Enumerate
Latitude-longitude meshes are orthogonal and have uniform resolution following
 co-ordinate lines but they have severe convergence of mesh lines towards
 two poles so numerical methods are needed that can cope with very large
 Courant numbers.
 We use a latitude-longitude mesh with a cell at each pole (fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset

).
\end_layout

\begin_layout Enumerate
Hexagonal and triangular meshes of the sphere are quasi-uniform but they
 cannot be all three of:
\end_layout

\begin_deeper
\begin_layout Enumerate
orthogonal (mesh lines and cell centre to cell centre lines cross at right
 angles)
\end_layout

\begin_layout Enumerate
centroidal (cell centres are at cell centroids)
\end_layout

\begin_layout Enumerate
non-skew (cell centre to cell centre lines bisect mesh lines)
\end_layout

\begin_layout Standard
meaning that special numerical treatment is needed in order to achieve second-or
der accuracy.
\end_layout

\end_deeper
\begin_layout Enumerate
Quasi-uniform versions of the cubed-sphere are non-orthogonal with large
 distortions (skewness) at cube edges and corners so numerical methods are
 needed that maintain accuracy at these distortions.
 The cubed-sphere in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset

 uses the Gnomonic projection 
\begin_inset CommandInset citation
LatexCommand citep
key "RPM96"

\end_inset

.
\end_layout

\begin_layout Enumerate
Skipped latitude-longitude meshes have factor of two reductions in resolution
 in the longitudinal direction at a few latitudes to prevent the mesh lines
 converging.
 At latitudes where the resolution reduces the meshes can be treated as
 non-conforming so that two quadrilateral cells are connected to one edge
 of the adjacent quadrilateral cell, or conforming with two quadrilaterals
 connected to adjacent, aligned edges of a distorted pentagon.
 The implementation described here treats them as conforming.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_latLonPolarSkipped_c2/latLon_48x24/constant/mesh.pdf
	lyxscale 50
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/weakDeformation/c1_MPDATA_cubedSphere_2gauge_adv/cube_15/constant/mesh.pdf
	lyxscale 50
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Skipped latitude-longitude, 
\begin_inset Formula $48\times24$
\end_inset

, 818 cells
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gnomonic cubed-sphere, 
\begin_inset Formula $15\times15\times6=1,350$
\end_inset

 cells 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/weakDeformation/MPDATA_HRgrid_2gauge_adv/HRgrid4/constant/mesh.pdf
	lyxscale 50
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/weakDeformation/MPDATA_tri_2gauge_adv/tri4/constant/mesh.pdf
	lyxscale 50
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hexagaonal icosahedron, 642 cells
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Triangular icosahedron, 1280 cells
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Some common meshes of the sphere viewed from above a point at a latitude
 of 
\begin_inset Formula $45^{o}$
\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "fig:grids"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
All of the meshes are decomposed into four domains for parallel processing
 with MPI.
\end_layout

\begin_layout Subsection
Deformational Flow
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand citet
key "LSPT12"

\end_inset

 describe deformational flow test cases to demonstrate a number of numerical
 properties of an advection scheme including order of convergence and monotonici
ty.
 We are using the non-divergent wind field which deforms and translates
 the initial conditions so that the final solution (at 
\begin_inset Formula $t=T=5$
\end_inset

) should be identical to the initial conditions (at 
\begin_inset Formula $t=0$
\end_inset

).
 The wind is defined by a stream function, 
\begin_inset Formula $\Psi$
\end_inset

, based on latitude, 
\begin_inset Formula $\phi$
\end_inset

, longitude, 
\begin_inset Formula $\lambda$
\end_inset

, time, 
\begin_inset Formula $t$
\end_inset

 and the radius of the sphere, 
\begin_inset Formula $R=1$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\Psi\left(\lambda,\phi,t\right)=\frac{10R}{T}\sin^{2}\left(\lambda-\frac{2\pi t}{T}\right)\cos^{2}\phi\cos\frac{\pi t}{T}-\frac{2\pi R}{T}\sin\phi
\end{equation}

\end_inset


\end_layout

\begin_layout Subsubsection
Gaussian Hills
\end_layout

\begin_layout Standard
The Gaussian hills initial conditions are infinitely smooth and so can be
 used to measure the numerical order of convergence.
 The initial conditions of the tracer, 
\begin_inset Formula $\psi_{0}$
\end_inset

, are given in terms of the three dimensional position vector, 
\begin_inset Formula $\mathbf{x}$
\end_inset

, in Caresian co-ordinates:
\begin_inset Formula 
\begin{eqnarray}
\psi_{0}\left(\mathbf{x}\right) & = & 0.95\left[\exp\left\{ -5\left(\mathbf{x}-\mathbf{x}_{1}\right)^{2}\right\} +\exp\left\{ -5\left(\mathbf{x}-\mathbf{x}_{2}\right)^{2}\right\} \right]\\
\text{where }\mathbf{x}_{i} & = & \left(R\cos\phi_{i}\cos\lambda_{i},\ R\cos\phi_{i}\sin\lambda_{i},\ R\sin\phi_{i}\right)\\
\left(\lambda_{1},\phi_{1}\right) & = & \left(5\pi/6,\ 0\right)\\
\left(\lambda_{2},\phi_{2}\right) & = & \left(7\pi/6,\ 0\right)
\end{eqnarray}

\end_inset

The tracer concentrations at 
\begin_inset Formula $t=2.5$
\end_inset

 are show in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 calculated on five different meshes of the sphere and for a 
\begin_inset Formula $30^{o}$
\end_inset

 rotated version of the latitude-longitude mesh, all at a similar resolution.
 The implicit/explicit 
\begin_inset Formula $\theta$
\end_inset

 MPDATA is used without flux limiting and without a gauge.
\end_layout

\begin_layout Standard
Simulations using all the meshes in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 use a time step of 
\begin_inset Formula $0.01$
\end_inset

 (500 time steps in total) giving a Courant number of around 2 so that the
 simulations would be unstable if a purely explicit scheme were used (although
 at 
\begin_inset Formula $t=2.5$
\end_inset

 on the latitude-longitude mesh the Courant number is everywhere below 0.8).
 Resolutions and time steps are shown in table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:dx_dt"

\end_inset

.
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="20" columns="6">
<features tabularvalignment="middle">
<column alignment="left" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Mesh type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Nominal
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
N.
 cells
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Delta x$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Delta t$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Figure
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Latitude-longitude
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $120\times60$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7,080
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3.0^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.02
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $240\times120$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
28,800
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $480\times240$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
114,720
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.75^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Skipped latitude-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $48\times24$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
864
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $7.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $120\times60$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5,310
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3.0^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.02
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
longitude
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $240\times120$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21,750
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $480\times240$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
88,470
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.75^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cubed-sphere
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $15\times15\times6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1,350
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $6.4^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $30\times30\times6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5,400
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3.2^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.02
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $60\times60\times6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21,600
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.6^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $120\times120\times6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
86,400
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.8^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hexagonal-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
HR4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
642
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $9.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
HR6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10,242
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2.4^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.02
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
icosahedral
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
HR7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
40,962
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.2^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
HR8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
163,842
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.6^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Triangular-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tri4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1,280
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $5.4^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:grids"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tri6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20,480
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.4^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
icosahedral
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tri7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
81,920
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.68^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tri8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
327,680
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.34^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.0025
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

c, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

b
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Resolutions and time steps for deformational advection.
\begin_inset CommandInset label
LatexCommand label
name "tab:dx_dt"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The flow goes to zero at the north and south poles so the convergence of
 meridians of the un-rotated latitude-longitude mesh does not lead to large
 Courant numbers.
 However when the mesh is rotated by 
\begin_inset Formula $30^{o}$
\end_inset

, high winds cross the poles of the mesh so the maximum Courant number goes
 up to 70 (the contours in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 show the Courant number).
 These large Courant numbers do not lead to instability, a lack of sign-preserva
tion or visible artefacts in the solution.
 The large Courant numbers are removed on the rotated, skipped latitude
 longitude mesh although some values above 0.8 are visible at 
\begin_inset Formula $t=2.5$
\end_inset

 just poleward of the change in longitudinal resolution.
 On the cubed-sphere, the Courant number is largest near the cube corners
 due to mesh distortions and smaller cell areas.
 Some mesh imprinting is visible along the cube edges although this does
 not lead to a lack of sign-preservation.
 The hexagonal and triangular icosahedral meshes are the most uniform meshes
 of the sphere and so no locally high Courant numbers are visible at 
\begin_inset Formula $t=2.5$
\end_inset

.
 The results from the hexagonal mesh appear accurate but note that this
 mesh has higher resolution that the other meshes, which explains the higher
 Courant number than the triangular mesh.
 On the triangular mesh, the maximum values are increased (from 0.95 to 1.08
 at 2.5s on triangular mesh 6).
 The anti-diffusion appears too strong which could be dangerous as it could
 lead to instability.
 It would probably be possible to optimise MPDATA for the triangular mesh
 but this has not been done.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_latLon_c2/latLon_240x120/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_latLonRotated_c2/latLon_240x120/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Full lat-lon, 
\begin_inset Formula $240\times120$
\end_inset

, 
\begin_inset Formula $\Delta x=1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Rotated, full lat-lon, 30
\begin_inset Formula $^{o}$
\end_inset

, 
\begin_inset Formula $240\times120$
\end_inset

, 
\begin_inset Formula $\Delta x=1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
28,800 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c\le2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
28,800 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c\le70$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_latLonSkipped_c2/latLon_240x120/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_cubedSphere_c2/cube_60/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Skipped, rotated lat-lon, 
\begin_inset Formula $240\times120$
\end_inset

, 
\begin_inset Formula $\Delta x\ge1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cubed-sphere, 
\begin_inset Formula $60\times60\times6$
\end_inset

, 
\begin_inset Formula $\Delta x\sim1.5^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21,750 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c<4.5$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21,600 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c<3.1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_HRgrid_c2/HRgrid7/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/fullDeformation/MPDATA_tri_c2/tri6/2.5/Traw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hexagaonal mesh 7, 
\begin_inset Formula $\Delta x\sim1.2^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Triangular mesh 6, 
\begin_inset Formula $\Delta x\sim1.3^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
40,962 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c\le2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20,480 cells, 
\begin_inset Formula $\Delta t=0.01$
\end_inset

 , 
\begin_inset Formula $c<2$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/legends/T.eps
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Deformational flow on the sphere after 2.5 time units.
 The colours show the tracer (piece-wise constant in each cell).
 The contours show the Courant number contoured every 0.2 starting from 
\begin_inset Formula $c=0.8$
\end_inset

 (grey) to 
\begin_inset Formula $c=2$
\end_inset

 (black) and dashed contours every 1 for 
\begin_inset Formula $c\ge3$
\end_inset

.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:fullDeformation2p5"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
MPDATA is, by design, sign-preserving but not bounded above or monotonic.
 The implicit/explicit MPDATA retains this feature on all of the meshes
 tested and displayed in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

.
 The mininum and maximum tracer values for all time steps for each of the
 meshes in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 are shown at the top of fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

.
 All of the minima remain positive and very close to zero.
 The maxima decrease due to numerical diffusion but they do not decrease
 monotonically MPDATA is not a monotonic scheme.
 The maximum on the triangular mesh increases and oscillates before it decreases
, would could be a feature that makes it prone to instability.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
Maximum and minimum tracer values for all time steps
\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/TminMax.eps
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
Maximum and mean (dashed) Courant number for all time steps
\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/CoMaxMean.eps
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
Convergence of 
\begin_inset Formula $\ell_{2}$
\end_inset

 error norm with resolution
\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/l2error.eps
	width 85text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Diagnostics of the results for the deformational flow of the Gaussian hills
 with standard implicit/explicit MPDATA (no flux corrected transport and
 no gauge).
 Top and middle are diagnostics of the simulations shown in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

.
 Bottom includes other resolutions.
 Mesh and time step details in table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:dx_dt"

\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "fig:MPDATAGuassiandiagnostics"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The maximum and mean Courant number for each time step for each of the meshes
 in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 are shown in the middle row of fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

.
 The maximum Courant number for all meshes is greater than one using the
 time step of 0.01 and is minimum at the middle of the simulation (
\begin_inset Formula $t=2.5$
\end_inset

).
 The maximum Courant number for the rotated latitude-longitude mesh reaches
 70 and is always much larger than one which does not appear to significantly
 reduce the accuracy.
 The mean Courant numbers (dashed) are below or close to one throughout
 which helps to maintain accuracy.
\end_layout

\begin_layout Standard
The convergence of the 
\begin_inset Formula $\ell_{2}$
\end_inset

 error norm with resolution is shown in the bottom row of fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

.
 The mesh resolutions and time steps for these simulations are given in
 table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:dx_dt"

\end_inset

.
 The resolution to time step ratio is kept constant along each line.
 Included in this graph is simulations using half the time step and five
 times the time step for the latitude-longitude mesh (giving maximum Courant
 number around one and around ten in order show the impact of varying the
 mean Courant number.
 Reducing the time step to get 
\begin_inset Formula $c<1$
\end_inset

 means that the standard explicit MPDATA is used almost everywhere.
 Surprisingly, this increases the error slightly.
 When the Courant number is close to 2, 
\begin_inset Formula $\theta$
\end_inset

 is close to 
\begin_inset Formula $\frac{1}{2}$
\end_inset

 and the temporal error correction is small.
 This implies that using second-order implicit/explicit time stepping is
 more accurate than using first-order time stepping with a correction.
 However the implicit/explicit time stepping requires a matrix inversion
 and so is more expensive.
 The simulation with 
\begin_inset Formula $c<10$
\end_inset

 is much less accurate because the temporal correction is not applied for
 
\begin_inset Formula $c>2$
\end_inset

.
 However the simulation is still stable and positive definite.
\end_layout

\begin_layout Standard
The convergence with resolution in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

 is around first-order at coarse resolution and approaches second-order
 at higher resolution.
 It is expected for second-order advection schemes to converge at less that
 second order at coarse resolution for this test case, as demonstrated in
 figures 1 and 2 of 
\begin_inset CommandInset citation
LatexCommand citet
key "LUJ+14"

\end_inset

 who presented results of this test case for a variety of advection schemes
 on different meshes.
 Errors saturate at coarse resolution and so the theoretical convergence
 rate is not achieved.
 The errors in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

 are similar to the second-order schemes presented in 
\begin_inset CommandInset citation
LatexCommand citet
key "LUJ+14"

\end_inset

.
 The exception is on the triangular mesh which looses accuracy at the highest
 resolution due to instabilities.
 
\end_layout

\begin_layout Standard
Better accuracy at the expense of sign-preservation can be achieved with
 MPDATA by using the infinite gauge variant (equivalent to Lax-Wendroff)
 which works for the 
\begin_inset Formula $\theta$
\end_inset

 implicit/explicit version in the same way as the standard MPDATA 
\begin_inset CommandInset citation
LatexCommand citep
key "SC86"

\end_inset

.
 The maximum and minimum values of the tracer for infinite gauge simulations
 with the same resolution as those shown in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformation2p5"

\end_inset

 are shown in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

.
 In comparison to the MPDATA simulations without a gauge (figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

) the gauge results have a smaller reduction in the maximum (because the
 results are more accurate and hence less diffusive) but the minima is less
 than zero (spurious undershoots are generated).
 
\begin_inset Formula $\ell_{2}$
\end_inset

 errors with resolution are shown at the bottom of fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGaugeDiagnostics"

\end_inset

.
 The mesh spacing and times steps are the same as in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

 and are shown in table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:dx_dt"

\end_inset

 .
 These simulations use one correction per time step.
 The order of convergence is higher and the 
\begin_inset Formula $\ell_{2}$
\end_inset

 errors lower than MPDATA results without a gauge (figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

).
 Again the results on the triangular mesh are not well behaved which could
 probably be fixed with optimisation for a triangular mesh.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
Maximum and minimum tracer values for all time steps
\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/TminMaxGauge.eps
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
Convergence of 
\begin_inset Formula $\ell_{2}$
\end_inset

 error norm with resolution
\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/l2errorGauge.eps
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Diagnostics of the results for the deformational flow of the Gaussian hills
 with implicit/explicit MPDATA with no flux corrected transport but with
 a gauge of 10.
 Other settings the same as fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MPDATAGuassiandiagnostics"

\end_inset

.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:MPDATAGaugeDiagnostics"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Slotted Cylinders
\end_layout

\begin_layout Standard
Deformational advection of slotted cylinders tests the implementation of
 limiters.
 
\begin_inset CommandInset citation
LatexCommand citet
key "LSPT12"

\end_inset

 recommend the same deformational velocity field as for the Gaussian hills
 with initial tracers defined by:
\begin_inset Formula 
\begin{eqnarray}
\psi_{0}\left(\lambda,\phi\right) & = & \begin{cases}
1 & \text{if }r_{i}\le r\text{ and }|\lambda-\lambda_{i}|\ge\frac{r}{6R}\text{ for }i=1,2\\
1 & \text{if }r_{1}\le r\text{ and }|\lambda-\lambda_{1}|<\frac{r}{6R}\text{ and }\phi-\phi_{1}<-\frac{5}{12}\frac{r}{R}\\
1 & \text{if }r_{2}\le r\text{ and }|\lambda-\lambda_{2}|<\frac{r}{6R}\text{ and }\phi-\phi_{2}>\frac{5}{12}\frac{r}{R}\\
0.1 & \text{otherwise}
\end{cases}\\
\text{where }\mathbf{x} & = & \left(R\cos\phi\cos\lambda,\ R\cos\phi\sin\lambda,\ R\sin\phi\right)\\
r & = & R/2,\ r_{i}=|\mathbf{x}-\mathbf{x}_{i}|\\
\left(\lambda_{1},\phi_{1}\right) & = & \left(5\pi/6,\ 0\right)\\
\left(\lambda_{2},\phi_{2}\right) & = & \left(7\pi/6,\ 0\right).
\end{eqnarray}

\end_inset

The tracer fields at the end of the simulations (
\begin_inset Formula $t=T=5$
\end_inset

) are shown in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset

 for all meshes at the highest resolution used and at time steps giving
 Courant numbers of around 2 (see table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:dx_dt"

\end_inset

).
 This uses the implicit/explicit infinite guage MPDATA and flux corrected
 transport limited to ensure monotonicity.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fullDeformationSlot5"

\end_inset

 shows that the bounds of the initial conditions are maintained and no new
 extrema are generated, even on the rotated latitude-longitude mesh where
 the Courant number reaches 140.
 The skipped latitude-longitude mesh has sharp jumps in the Courant number
 which do not cause artefacts in the solution.
 The flux correction also removes the overshoots from the triangular mesh
 solution.
 This is, to our knowledge, the first monotonic and conservative solution
 of the advection equation using such a large Courant number.
\end_layout

\begin_layout Standard
\noindent
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_latLonPolar_c2/latLon_480x240/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_latLonPolarRotated_c2/latLon_480x240/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Full lat-lon, 
\begin_inset Formula $480\times240$
\end_inset

, 
\begin_inset Formula $\Delta x=0.75{}^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Rotated 30
\begin_inset Formula $^{o}$
\end_inset

, full lat-lon, 
\begin_inset Formula $480\times240$
\end_inset

, 
\begin_inset Formula $\Delta x=0.75{}^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
115,200 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c\le2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
115,200 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c\le140$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_latLonPolarSkipped_c2/latLon_480x240/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_cubedSphere_c2/cube_120/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Skipped, rotated lat-lon, 
\begin_inset Formula $480\times240$
\end_inset

, 
\begin_inset Formula $\Delta x\ge0.75^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cubed-sphere, 
\begin_inset Formula $120\times120\times6$
\end_inset

, 
\begin_inset Formula $\Delta x\sim0.75^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
88,470 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c<4.5$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
86,400 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c<3.1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_HRgrid_c2/HRgrid8/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/slottedCylinder/LW_FCT_tri_c2/tri7/5/TslotRaw.pdf
	lyxscale 75
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hexagaonal mesh 8, 
\begin_inset Formula $\Delta x\sim0.6^{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Triangular mesh 7, 
\begin_inset Formula $\Delta x\sim0.7^{o}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
163,842 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c\le2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
81,920 cells, 
\begin_inset Formula $\Delta t=0.005$
\end_inset

 , 
\begin_inset Formula $c<2$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/legends/TslotRaw_T.eps
	width 48text%

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Deformational flow on the sphere after 5 time units.
 The colours show the piecewise uniform value of the tracer value in each
 cell.
 The contours show the Courant number contoured every 0.2 starting from 
\begin_inset Formula $c=0.8$
\end_inset

 (grey) to 
\begin_inset Formula $c=2$
\end_inset

 (black) and dotted black contours every 1 for 
\begin_inset Formula $c\ge3$
\end_inset

.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:fullDeformationSlot5"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Solver Performance
\begin_inset CommandInset label
LatexCommand label
name "subsec:SolverPerformace"

\end_inset


\end_layout

\begin_layout Standard
Solver performance is reported for a selection of simulations using full
 latitude-longitude meshes as the large inhomogeneity of cell size and large
 range of Courant numbers leads to an ill conditioned matrix and poor solver
 performance 
\begin_inset CommandInset citation
LatexCommand citep
key "TB15"

\end_inset

.
 The full latitude-longitude mesh therefore represents a worst case.
 Each time step consists of one implicit solve using the standard OpenFOAM
 bi-conjugate gradient solver with a diagonal-based Incomplete LU preconditioner.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename /home/hilary/OpenFOAM/hilary-7/run/hilary/advection/deformingOnSphere/plots/iterations.eps
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Number of solver iterations per time step for simulations on unrotated latitude-
longitude meshes.
 The legend shows if the simulation used a solver tolerance of 
\begin_inset Formula $10^{-6}$
\end_inset

 or 
\begin_inset Formula $10^{-12}$
\end_inset

.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:nIterations"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The number of iterations of the solver per time step is shown in fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:nIterations"

\end_inset

 for various simulations on different resolutions of the latitude-longitude
 mesh.
 The number of iterations is smallest around time 2.5 when the wind speed
 is lowest and so the Courant number is smallest.
 For simulations with the maximum Courant number less than 0.75 in the middle
 of the simulations, the number of solver iterations drops to zero because
 the simulation is purely explicit.
 The simulations represented by black lines have a maximum Courant number
 of 1 and so the number of iterations is small throughout the simulation.
 For the simulations with a maximum Courant number of 2 (in blue), the number
 of iterations is always below 5.
 Once the maximum Courant number reaches 10, the number of iterations can
 be over 15.
 The number of iterations increases slower than linearly with Courant number,
 which is necessary for efficiency.
 However it is possible to reduce the number of iterations by reducing the
 solver tolerance.
 The tighter tolerance made less than 1% difference to the error norms of
 the final solution (not shown).
 Higher spatial resolution has little influence on the number of iterations
 per time step.
 
\end_layout

\begin_layout Section
Conclusions
\end_layout

\begin_layout Section*
Acknowledgements
\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "numerics"
options "abbrvnat"

\end_inset


\end_layout

\begin_layout Section
\start_of_appendix
Boundedness of the first-order Upwind Implicit/Explicit Scheme
\begin_inset CommandInset label
LatexCommand label
name "sec:appxBounded"

\end_inset


\end_layout

\begin_layout Standard
The first-order upwind, implicit/explicit scheme can be written:
\begin_inset Formula 
\begin{eqnarray}
\psi_{C}^{n+1}=\psi_{C}^{n} & + & \frac{\Delta t}{V_{C}}\sum_{i\in\text{in}}\left(1-\theta_{i}\right)U_{i}\psi_{i}^{n}+\frac{\Delta t}{V_{C}}\sum_{i\in\text{in}}\theta_{i}U_{i}\psi_{i}^{n+1}\label{eq:thetaUp-2}\\
 & - & \frac{\Delta t}{V_{C}}\sum_{o\in\text{out}}\left(1-\theta_{o}\right)U_{o}\psi_{C}^{n}-\frac{\Delta t}{V_{C}}\sum_{o\in\text{out}}\theta_{o}U_{o}\psi_{C}^{n+1}\nonumber 
\end{eqnarray}

\end_inset

for cell 
\begin_inset Formula $C$
\end_inset

 with faces 
\begin_inset Formula $i\in\text{in}$
\end_inset

 with flow into cell 
\begin_inset Formula $C$
\end_inset

 and faces 
\begin_inset Formula $j\in\text{out}$
\end_inset

 with flow out of cell 
\begin_inset Formula $C$
\end_inset

, off-centering values 
\begin_inset Formula $\theta_{i,j}\in[0,1]$
\end_inset

, 
\begin_inset Formula $U_{i,o}$
\end_inset

 the volume fluxes through faces 
\begin_inset Formula $i,o$
\end_inset

 and 
\begin_inset Formula $\psi_{i}$
\end_inset

 the values of 
\begin_inset Formula $\psi$
\end_inset

 in cells through the 
\begin_inset Formula $i$
\end_inset

 faces.
 The 
\begin_inset Formula $\theta_{i,o}$
\end_inset

 are defined on faces for conservation so the boundedness properties of
 this scheme require thought.
 This can be re-arranged to give:
\begin_inset Formula 
\begin{equation}
\psi_{C}^{n+1}=\gamma\psi_{C}^{n}+{\displaystyle \sum_{_{i\in\text{in}}}}\alpha_{i}\psi_{i}^{n}+\sum_{_{i\in\text{in}}}\beta_{i}\psi_{i}^{n+1}\label{eq:convexScheme}
\end{equation}

\end_inset

where
\begin_inset Formula 
\begin{eqnarray*}
\alpha_{i} & = & \frac{\frac{\Delta t}{V_{C}}\left(1-\theta_{i}\right)U_{i}}{1+\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}\theta_{o}U_{o}}\text{ for each }i\\
\beta_{i} & = & \frac{\frac{\Delta t}{V_{j}}\theta_{i}U_{i}}{1+\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}\theta_{o}U_{o}}\text{ for each }i\\
\gamma & = & \frac{1-\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}\left(1-\theta_{o}\right)U_{o}}{1+\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}\theta_{o}U_{o}}.
\end{eqnarray*}

\end_inset


\begin_inset Formula $\alpha_{i}$
\end_inset

, 
\begin_inset Formula $\beta_{i}$
\end_inset

 and 
\begin_inset Formula $\gamma$
\end_inset

 are all positive as long as the 
\begin_inset Formula $\theta_{0}$
\end_inset

 are chosen to give
\begin_inset Formula 
\begin{equation}
\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}\left(1-\theta_{o}\right)U_{o}\le1
\end{equation}

\end_inset

which can be accomplished by setting
\begin_inset Formula 
\begin{equation}
\theta_{f}\ge1-\frac{1}{\frac{\Delta t}{V_{C}}{\displaystyle \sum_{o\in\text{out}}}U_{o}}
\end{equation}

\end_inset

for the cells either side of face 
\begin_inset Formula $f$
\end_inset

.
 Hence all 
\begin_inset Formula $\psi$
\end_inset

 are positive at the next time step.
 If, in addition the flow is discretely divergence free then:
\begin_inset Formula 
\begin{equation}
\sum_{i\in\text{in}}U_{i}=\sum_{o\in\text{out}}U_{o}
\end{equation}

\end_inset

which implies
\begin_inset Formula 
\begin{equation}
\sum_{i\in\text{in}}\alpha_{i}+\sum_{i\in\text{in}}\beta_{i}+\gamma=1\label{eq:convexParams}
\end{equation}

\end_inset

so from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:convexScheme"

\end_inset

) 
\begin_inset Formula $\psi_{C}^{n+1}$
\end_inset

 is a convex combination of 
\begin_inset Formula $\psi_{C}^{n}$
\end_inset

, 
\begin_inset Formula $\psi_{i}^{n}$
\end_inset

 and 
\begin_inset Formula $\psi_{i}^{n+1}$
\end_inset

.
 This in fact proves that the scheme is globally bounded.
 This can be shown by contradiction.
 If we assume that 
\begin_inset Formula $\psi_{C}^{n+1}$
\end_inset

 is the global maximum at time 
\begin_inset Formula $n+1$
\end_inset

 and it is greater than 
\begin_inset Formula $\psi_{j}^{n}$
\end_inset

 for all cells 
\begin_inset Formula $j$
\end_inset

 in the mesh then (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:convexScheme"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:convexParams"

\end_inset

) cannot both hold for cell 
\begin_inset Formula $C$
\end_inset

.
 It is necessary for this scheme to be bounded as it is used as the bounded
 scheme for the flux corrected transport (section 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:FCT"

\end_inset

).
\end_layout

\begin_layout Section
Stability Analysis of the Second-Order Implicit/Explicit Scheme
\begin_inset CommandInset label
LatexCommand label
name "sec:appxStability"

\end_inset


\end_layout

\begin_layout Standard
MPDATA is a non-linear scheme but the infinite gauge version becomes the
 linear Lax-Wendroff scheme and so von-Neumman stability analysis can be
 applied.
 In one dimension, for constant velocity, 
\begin_inset Formula $u>0$
\end_inset

, and constant Courant number 
\begin_inset Formula $c=u\Delta t/\Delta x$
\end_inset

, the one-dimensional implicit/explicit Lax-Wendroff scheme is
\begin_inset Formula 
\begin{eqnarray}
\psi_{j}^{n+1} & = & \psi_{j}^{n}-c\left(1-\theta\right)\left(\psi_{j}^{n}-\psi_{j-1}^{n}\right)-c\theta\left(\psi_{j}^{n+1}-\psi_{j-1}^{n+1}\right)\label{eq:LWtheta}\\
 & - & \frac{c}{2}\left(1-\chi c\right)\left(\psi_{j+1}^{n}-2\psi_{j}^{n}+\psi_{j-1}^{n}\right)\nonumber 
\end{eqnarray}

\end_inset

where we showed in section 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:MPDATA_theta"

\end_inset

 that 
\begin_inset Formula $\chi=1-2\theta$
\end_inset

 gives second-order accuracy.
 From appendix 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:appxBounded"

\end_inset

 we can see that we need 
\begin_inset Formula $\theta>1-1/c$
\end_inset

 for stability of the first-order upwind part (the first two terms of (
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:LWtheta"

\end_inset

)).
 In order to revert to the explicit version for 
\begin_inset Formula $c\le1$
\end_inset

 and to transition smoothly to the implicit version we use
\begin_inset Formula 
\begin{equation}
\theta=\begin{cases}
0 & c\le1\\
1-\frac{1}{c} & c>1
\end{cases}
\end{equation}

\end_inset

and analyse (
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:LWtheta"

\end_inset

) separately for these two cases.
 Considering a Fourier mode with wavenumber 
\begin_inset Formula $k$
\end_inset

, the amplification factor, 
\begin_inset Formula $A$
\end_inset

, of (
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:LWtheta"

\end_inset

) is
\begin_inset Formula 
\begin{equation}
A=\frac{1-c\left(\chi c-\theta\right)\left(1-\cos k\Delta x\right)-ic\left(1-\theta\right)\sin k\Delta x}{1+c\theta\left(1-\cos k\Delta x\right)+ic\theta\sin k\Delta x}.
\end{equation}

\end_inset

For 
\begin_inset Formula $\theta=0$
\end_inset

 and 
\begin_inset Formula $\chi=1$
\end_inset

 we recover the usual Lax-Wendroff stability constraints of 
\begin_inset Formula $c\in\left[-1,1\right]$
\end_inset

.
 For 
\begin_inset Formula $c\ge1$
\end_inset

 and 
\begin_inset Formula $\theta=1-\frac{1}{c}$
\end_inset

 it can be shown that stability requires 
\begin_inset Formula $\chi\in\left[0,\frac{2c-1}{c^{2}}\right]$
\end_inset

.
 The stability range for 
\begin_inset Formula $\chi$
\end_inset

 is compared with the second-order requirement for 
\begin_inset Formula $\chi$
\end_inset

 in figure 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:MPDATA_chi"

\end_inset

.
 For behaviour as close as possible to second-order for the maximum range
 of Courant numbers and for stability we use:
\begin_inset Formula 
\begin{equation}
\chi=\max\left(1-2\theta,\ 0\right).
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename figures/LWstability.pdf
	width 75text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Comparison of the stability limits, the second-order requirement and the
 value of 
\begin_inset Formula $\chi$
\end_inset

 used for the MPDATA correction.
\begin_inset CommandInset label
LatexCommand label
name "fig:MPDATA_chi"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
